/**
 * @ 省市联动插件 by 前端老徐 2017-1-12
 * 
	<form id="form">
		<select id="province-picker"></select>
		<select id="city-picker"></select>
	</form>
	<script>
		cityPicker.init({
			pId: 'province-picker', //省id              必填
			cId: 'city-picker',     //市id              必填
			default: [5, 127],      //默认[省，市]id    非必填
			formId:"form"           //必填，不填写则form 发生reset事件的时候会出问题
		})
	</script>
 */
function CityPicker() {
	this.province = [
		["1", "北京"],
		["2", "上海"],
		["3", "天津"],
		["4", "重庆"],
		["5", "黑龙江"],
		["6", "吉林"],
		["7", "辽宁"],
		["8", "内蒙古"],
		["9", "宁夏"],
		["10", "新疆"],
		["11", "青海"],
		["12", "甘肃"],
		["13", "陕西"],
		["14", "河北"],
		["15", "河南"],
		["16", "山东"],
		["17", "山西"],
		["18", "湖北"],
		["19", "湖南"],
		["20", "安徽"],
		["21", "江苏"],
		["22", "浙江"],
		["23", "江西"],
		["24", "广东"],
		["25", "广西"],
		["26", "福建"],
		["27", "四川"],
		["28", "云南"],
		["29", "贵州"],
		["30", "西藏"],
		["31", "海南"],
		["32", "香港"],
		["33", "澳门"],
		["34", "台湾"]
	];
	this.city = [
		["1-1", "北京"],
		["2-18", "上海"],
		["3-38", "天津"],
		["4-46", "重庆"],
		["24-331", "东莞"],
		["24-332", "中山"],
		["24-430", "中山"],
		["24-342", "云浮"],
		["24-334", "佛山"],
		["24-426", "南海"],
		["24-428", "台山"],
		["24-429", "增城"],
		["24-431", "市梅"],
		["24-84", "广州"],
		["24-425", "开平"],
		["24-329", "惠州"],
		["24-341", "揭阳"],
		["24-328", "梅州"],
		["24-325", "汕头"],
		["24-330", "汕尾"],
		["24-333", "江门"],
		["24-327", "河源"],
		["24-85", "深圳"],
		["24-339", "清远"],
		["24-336", "湛江"],
		["24-340", "潮州"],
		["24-324", "珠海"],
		["24-338", "肇庆"],
		["24-424", "花都"],
		["24-337", "茂名"],
		["24-335", "阳江"],
		["24-326", "韶关"],
		["24-427", "顺德"],
		["28-388", "临沧"],
		["28-389", "丽江"],
		["28-385", "保山"],
		["28-513", "大理"],
		["28-395", "德宏傣族景颇族自治州"],
		["28-396", "怒江傈傈族自治州"],
		["28-387", "思茅地区"],
		["28-390", "文山壮族苗族自治州"],
		["28-90", "昆明"],
		["28-386", "昭通"],
		["28-383", "曲靖"],
		["28-393", "楚雄"],
		["28-384", "玉溪"],
		["28-391", "红河州"],
		["28-392", "西双版纳州"],
		["28-397", "迪庆藏族自治州"],
		["8-160", "乌兰察布盟"],
		["8-471", "乌兰浩特"],
		["8-155", "乌海"],
		["8-164", "兴安盟"],
		["8-59", "包头"],
		["8-469", "呼伦贝尔"],
		["8-159", "呼和浩特"],
		["8-58", "呼和浩特"],
		["8-468", "巴彦淖尔"],
		["8-162", "巴彦淖尔盟"],
		["8-156", "赤峰"],
		["8-157", "通辽"],
		["8-158", "鄂尔多斯"],
		["8-472", "锡林浩特"],
		["8-161", "锡林郭勒盟"],
		["8-163", "阿拉善盟"],
		["8-470", "集宁"],
		["34-99", "台中"],
		["34-97", "台北"],
		["34-100", "台南"],
		["34-101", "基隆"],
		["34-102", "新竹"],
		["34-98", "高雄"],
		["6-54", "吉林"],
		["6-137", "四平"],
		["6-450", "延吉"],
		["6-143", "延边州"],
		["6-141", "松原"],
		["6-451", "梅河口"],
		["6-142", "白城"],
		["6-140", "白山"],
		["6-138", "辽源"],
		["6-139", "通化"],
		["6-53", "长春"],
		["6-449", "高新"],
		["27-371", "乐山"],
		["27-370", "内江"],
		["27-382", "凉山州"],
		["27-372", "南充"],
		["27-373", "宜宾"],
		["27-376", "巴中"],
		["27-368", "广元"],
		["27-374", "广安"],
		["27-497", "广汉"],
		["27-366", "德阳"],
		["27-89", "成都"],
		["27-364", "攀枝花"],
		["27-365", "泸州"],
		["27-381", "甘孜藏族自治州"],
		["27-378", "眉山"],
		["27-367", "绵阳"],
		["27-363", "自贡"],
		["27-499", "西昌"],
		["27-379", "资阳"],
		["27-375", "达州"],
		["27-369", "遂宁"],
		["27-498", "锦阳"],
		["27-380", "阿坝藏族羌族自治州"],
		["27-377", "雅安"],
		["9-166", "吴忠"],
		["9-167", "固原"],
		["9-165", "石嘴山"],
		["9-60", "银川"],
		["20-289", "亳州"],
		["20-288", "六安"],
		["20-79", "合肥"],
		["20-413", "宁国"],
		["20-282", "安庆"],
		["20-291", "宣城"],
		["20-286", "宿州"],
		["20-287", "巢湖"],
		["20-414", "桐城"],
		["20-290", "池州"],
		["20-280", "淮北"],
		["20-278", "淮南"],
		["20-284", "滁州"],
		["20-80", "芜湖"],
		["20-412", "蒙城"],
		["20-277", "蚌埠"],
		["20-281", "铜陵"],
		["20-285", "阜阳"],
		["20-279", "马鞍山"],
		["20-283", "黄山"],
		["16-231", "东营"],
		["16-239", "临沂"],
		["16-485", "乳山"],
		["16-477", "即墨"],
		["16-233", "威海"],
		["16-486", "寿光"],
		["16-238", "德州"],
		["16-489", "招远"],
		["16-488", "文登"],
		["16-236", "日照"],
		["16-480", "林沂"],
		["16-230", "枣庄"],
		["16-235", "泰安"],
		["16-72", "济南"],
		["16-234", "济宁"],
		["16-229", "淄博"],
		["16-476", "淮坊"],
		["16-487", "滕州"],
		["16-241", "滨州"],
		["16-232", "潍坊"],
		["16-74", "烟台"],
		["16-240", "聊城"],
		["16-478", "胶南"],
		["16-475", "荷泽"],
		["16-479", "莱州"],
		["16-237", "莱芜"],
		["16-483", "蓬莱"],
		["16-73", "青岛"],
		["16-484", "青州"],
		["16-474", "高密"],
		["16-482", "龙口"],
		["17-249", "临汾"],
		["17-492", "侯马"],
		["17-251", "吕梁"],
		["17-76", "大同"],
		["17-75", "太原"],
		["17-494", "孝义"],
		["17-247", "忻州"],
		["17-248", "晋中"],
		["17-246", "晋城"],
		["17-493", "朔州"],
		["17-243", "朔州"],
		["17-495", "榆次"],
		["17-491", "河津"],
		["17-250", "运城"],
		["17-245", "长治"],
		["17-244", "阳泉"],
		["25-346", "北海"],
		["25-86", "南宁"],
		["25-355", "崇左"],
		["25-354", "来宾"],
		["25-343", "柳州"],
		["25-344", "桂林"],
		["25-345", "梧州"],
		["25-353", "河池"],
		["25-350", "玉林"],
		["25-351", "百色"],
		["25-349", "贵港"],
		["25-352", "贺州"],
		["25-348", "钦州"],
		["25-347", "防城港"],
		["10-509", "乌市"],
		["10-61", "乌鲁木齐"],
		["10-512", "伊宁"],
		["10-511", "伊犁"],
		["10-178", "伊犁哈萨克自治州"],
		["10-174", "克孜勒苏柯尔克孜自治州"],
		["10-168", "克拉玛依"],
		["10-505", "克拉马依"],
		["10-177", "博尔塔拉蒙古自治州"],
		["10-508", "吐鲁番"],
		["10-169", "吐鲁番地区"],
		["10-503", "和田"],
		["10-171", "和田地区"],
		["10-502", "哈密"],
		["10-170", "哈密地区"],
		["10-504", "喀什"],
		["10-173", "喀什地区"],
		["10-510", "奎屯"],
		["10-175", "巴音郭楞蒙古自治州"],
		["10-506", "库尔勒"],
		["10-501", "昌吉"],
		["10-176", "昌吉回族自治州"],
		["10-507", "石河子"],
		["10-500", "阿克苏"],
		["10-172", "阿克苏地区"],
		["21-453", "丹阳"],
		["21-81", "南京"],
		["21-299", "南通"],
		["21-463", "吴县"],
		["21-462", "吴江"],
		["21-460", "太仓"],
		["21-464", "宜兴"],
		["21-295", "宿迁"],
		["21-301", "常州"],
		["21-452", "常熟"],
		["21-465", "张家港"],
		["21-292", "徐州"],
		["21-297", "扬州"],
		["21-302", "无锡"],
		["21-458", "昆山"],
		["21-455", "江都"],
		["21-456", "江阴"],
		["21-298", "泰州"],
		["21-461", "泰州华"],
		["21-454", "海门"],
		["21-294", "淮安"],
		["21-459", "溧阳"],
		["21-296", "盐城"],
		["21-303", "苏州"],
		["21-293", "连云港"],
		["21-300", "镇江"],
		["21-457", "靖江"],
		["23-323", "上饶"],
		["23-317", "九江"],
		["23-83", "南昌"],
		["23-320", "吉安"],
		["23-321", "宜春"],
		["23-322", "抚州"],
		["23-316", "新余"],
		["23-314", "景德镇"],
		["23-315", "萍乡"],
		["23-319", "赣州"],
		["23-466", "高安"],
		["23-318", "鹰潭"],
		["14-438", "任丘"],
		["14-69", "保定"],
		["14-205", "唐山"],
		["14-212", "廊坊"],
		["14-209", "张家口"],
		["14-210", "承德"],
		["14-211", "沧州"],
		["14-439", "涿州"],
		["14-68", "石家庄"],
		["14-206", "秦皇岛"],
		["14-213", "衡水"],
		["14-208", "邢台"],
		["14-207", "邯郸"],
		["14-436", "霸州"],
		["14-437", "青县"],
		["15-223", "三门峡"],
		["15-226", "信阳"],
		["15-224", "南阳"],
		["15-227", "周口"],
		["15-225", "商丘"],
		["15-219", "安阳"],
		["15-215", "平顶山"],
		["15-214", "开封"],
		["15-218", "新乡"],
		["15-71", "洛阳"],
		["15-530", "济源"],
		["15-222", "漯河"],
		["15-220", "濮阳"],
		["15-216", "焦作"],
		["15-221", "许昌"],
		["15-70", "郑州"],
		["15-228", "驻马店"],
		["15-217", "鹤壁"],
        ["22-82", "杭州"],
		["22-522", "上虞"],
		["22-515", "东阳"],
		["22-518", "临安"],
		["22-519", "临海"],
		["22-313", "丽水"],
		["22-525", "义乌"],
		["22-517", "乐清"],
		["22-527", "余姚"],
		["22-312", "台州"],
		["22-306", "嘉兴"],
		["22-516", "奉化"],
		["22-304", "宁波"],
		["22-523", "嵊州"],
		["22-520", "平湖"],
		["22-514", "慈溪"],
		["22-529", "新昌"],
		["22-526", "永康"],
		["22-524", "温岭"],
		["22-305", "温州"],
		["22-307", "湖州"],
		["22-521", "瑞安"],
		["22-308", "绍兴"],
		["22-311", "舟山"],
		["22-310", "衢州"],
		["22-528", "诸暨"],
		["22-309", "金华"],
		["31-94", "三亚"],
		["31-93", "海口"],
		["18-445", "仙桃"],
		["18-254", "十堰"],
		["18-261", "咸宁"],
		["18-259", "孝感"],
		["18-440", "安陆"],
		["18-256", "宜昌"],
		["18-441", "恩施"],
		["18-263", "恩施州"],
		["18-446", "株州"],
		["18-77", "武汉"],
		["18-442", "汉口"],
		["18-443", "汉阳"],
		["18-444", "潜江"],
		["18-255", "荆州"],
		["18-257", "荆门"],
		["18-253", "襄阳"],
		["18-258", "鄂州"],
		["18-262", "随州"],
		["18-260", "黄冈"],
		["18-252", "黄石"],
		["19-275", "娄底"],
		["19-268", "岳阳"],
		["19-269", "常德"],
		["19-270", "张家界"],
		["19-274", "怀化"],
		["19-447", "株州"],
		["19-264", "株洲"],
		["19-273", "永州"],
		["19-265", "湘潭"],
		["19-276", "湘西土家族苗族自治州"],
		["19-271", "益阳"],
		["19-266", "衡阳"],
		["19-448", "邵东"],
		["19-267", "邵阳"],
		["19-272", "郴州"],
		["19-78", "长沙"],
		["33-96", "澳门"],
		["12-197", "临夏回族自治州"],
		["12-63", "兰州"],
		["12-422", "嘉峪"],
		["12-188", "嘉峪关"],
		["12-64", "天水"],
		["12-194", "定西地区"],
		["12-191", "平凉"],
		["12-193", "庆阳"],
		["12-190", "张掖"],
		["12-423", "武威"],
		["12-196", "甘南藏族自治州"],
		["12-187", "白银"],
		["12-192", "酒泉"],
		["12-186", "金昌"],
		["12-195", "陇南"],
		["26-356", "三明"],
		["26-421", "仙游"],
		["26-418", "南安"],
		["26-360", "南平"],
		["26-88", "厦门"],
		["26-362", "宁德"],
		["26-416", "建瓯"],
		["26-417", "晋江"],
		["26-358", "泉州"],
		["26-359", "漳州"],
		["26-420", "石狮"],
		["26-87", "福州"],
		["26-415", "福清"],
		["26-357", "莆田"],
		["26-419", "邵武"],
		["26-361", "龙岩"],
		["30-408", "山南地区"],
		["30-92", "拉萨"],
		["30-409", "日喀则地区"],
		["30-407", "昌都地区"],
		["30-411", "林芝地区"],
		["30-406", "那曲地区"],
		["30-410", "阿里地区"],
		["29-398", "六盘水"],
		["29-434", "凯里"],
		["29-400", "安顺"],
		["29-402", "毕节"],
		["29-433", "贵恙"],
		["29-91", "贵阳"],
		["29-399", "遵义"],
		["29-432", "都匀"],
		["29-435", "铜仁"],
		["29-401", "铜仁地区"],
		["29-404", "黔东南州"],
		["29-405", "黔南布依族苗族自治州"],
		["29-403", "黔西南布依族苗族自治州"],
		["7-147", "丹东"],
		["7-56", "大连"],
		["7-145", "抚顺"],
		["7-154", "朝阳"],
		["7-146", "本溪"],
		["7-55", "沈阳"],
		["7-467", "瓦房店"],
		["7-150", "盘锦"],
		["7-149", "营口"],
		["7-148", "葫芦岛"],
		["7-152", "辽阳"],
		["7-153", "铁岭"],
		["7-57", "锦州"],
		["7-151", "阜新"],
		["7-144", "鞍山"],
		["13-199", "咸阳"],
		["13-204", "商洛"],
		["13-203", "安康"],
		["13-66", "宝鸡"],
		["13-67", "延安"],
		["13-202", "榆林"],
		["13-201", "汉中"],
		["13-200", "渭南"],
		["13-65", "西安"],
		["13-198", "铜川"],
		["13-496", "韩城"],
		["11-183", "果洛藏族自治州"],
		["11-473", "格尔木"],
		["11-179", "海东地区"],
		["11-180", "海北藏族自治州"],
		["11-182", "海南藏族自治州"],
		["11-185", "海西蒙古族藏族自治州"],
		["11-184", "玉树藏族自治州"],
		["11-62", "西宁"],
		["11-181", "黄南藏族自治州"],
		["32-95", "香港"],
		["5-133", "七台河"],
		["5-131", "伊春"],
		["5-132", "佳木斯"],
		["5-128", "双鸭山"],
		["5-50", "哈尔滨"],
		["5-136", "大兴安岭地区"],
		["5-130", "大庆"],
		["5-52", "牡丹江"],
		["5-135", "绥化"],
		["5-129", "鸡西"],
		["5-127", "鹤岗"],
		["5-134", "黑河"],
		["5-51", "齐齐哈尔"]
	];
}

CityPicker.prototype = {
	each: function(data, callback) {
		for (var i in data) {
			callback(i, data[i]);
		}
	},
	init: function(param) {
		var defaultForCookie=this.getCookie('prov-city');
		if(defaultForCookie){
			var arr=defaultForCookie.split('-');
			param.default = [arr[0],arr[1]];
		}else{
			param.default = param.default || [1, 1];
		}
		var self = this,
			fra = document.createDocumentFragment();
		self.obj1 = document.getElementById(param.pId);
		self.obj2 = document.getElementById(param.cId);
		self.each(self.province, function(index, data) {
			var opt = document.createElement('option');
			opt.appendChild(document.createTextNode(data[1]));
			opt.setAttribute('value', data[0]);
			fra.appendChild(opt);
			if (param.default[0] == data[0]) {
				opt.selected = true;
			}
		});
		self.obj1.appendChild(fra);
		self.getCity(param.default);
		self.obj1.onchange = function() {
			self.getCity([this.value]);
		}
		//处理表单reset
		if(param.formId){
			document.getElementById(param.formId).onreset=function(){
				self.set(1,1);
			}
		}
	},
	getCity: function(param) {
		var self = this,
			fra = document.createDocumentFragment();
		self.each(self.city, function(index, data) {
			var opt = document.createElement('option'),
				ids = data[0].split('-'),
				pid = ids[0],
				id = ids[1];
			if (pid == param[0]) {
				opt.appendChild(document.createTextNode(data[1]));
				opt.setAttribute('value', id);
				fra.appendChild(opt);
				if (id == param[1]) {
					opt.selected = true;
				}
			}
		});
		self.obj2.innerHTML = '';
		self.obj2.appendChild(fra);
		self.obj2.onchange = function() {
			self.setCookie("prov-city",self.obj1.value+'-'+self.obj2.value,7);
		}
		self.setCookie("prov-city",self.obj1.value+'-'+self.obj2.value,7);
	},
	set:function(a,b){
		this.obj1.value=a;
		this.getCity([a,b]);
	},
	setCookie: function(c_name, value, expiredays) {
		var exdate = new Date()
		exdate.setDate(exdate.getDate() + expiredays)
		document.cookie = c_name + "=" + escape(value) +
			((expiredays == null) ? "" : ";expires=" + exdate.toGMTString())+";path=/"
	},
	getCookie: function(c_name) {
		if (document.cookie.length > 0) {
			c_start = document.cookie.indexOf(c_name + "=")
			if (c_start != -1) {
				c_start = c_start + c_name.length + 1
				c_end = document.cookie.indexOf(";", c_start)
				if (c_end == -1) c_end = document.cookie.length
				return unescape(document.cookie.substring(c_start, c_end))
			}
		}
		return ""
	}
}
var cityPicker = new CityPicker();